Implement the requested change with comprehensive test cases. Ensure all tests pass on Linux, macOS, and Windows. Commit when confident.